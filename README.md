Installation Guide

This guide walks you through setting up and using the automated OCT tracking workflow. It consists of two Python scripts:

- eye_sorter.py:  
  - Moves new OCT scan images into an “unsorted” folder.
  - Uses OCR to extract dates and central foveal thickness (CFT) measurements.
  - Separates invalid images and provides a manual step to sort valid images into “left” or “right” folders.
  - Generates two Excel files (one for left and one for right eyes).

- oct-tracker-final.py:  
  - Reads the latest Excel files generated by eye_sorter.py.
  - Takes user input (e.g., patient ID, injection dates, etc.).
  - Automatically pulls the closest OCT/CFT values and identifies the best (lowest) CFT between treatment dates.
  - Creates a final tracking sheet in Excel for clinical use.

---

 Prerequisites

1. Python Environment:
   - Install Python 3.8 or higher.
   - It is recommended to use a virtual environment (e.g., `venv` or Conda).

2. Required Python Libraries:
   - [OpenCV](https://opencv.org/) for image processing.
   - [Pytesseract](https://github.com/madmaze/pytesseract) for OCR.
   - [Pandas](https://pandas.pydata.org/) for Excel file handling.
   - [Openpyxl](https://openpyxl.readthedocs.io/) for Excel output formatting.

   You can install them via pip:
   ```bash
   pip install opencv-python pytesseract pandas openpyxl
   ```

3. Tesseract OCR Engine:
   - Download and install Tesseract from [Tesseract OCR GitHub](https://github.com/tesseract-ocr/tesseract) or your platform’s package manager.
   - Make sure Tesseract is added to your system’s PATH.
   - You can test it by running:
     ```bash
     tesseract --version
     ```

---

 Folder Structure

Organize your project folder as follows:
```
your-project/
├── eye_sorter.py
├── oct-tracker-final.py
├── requirements.txt  # Optional: list of dependencies
├── README.md         # Project description and usage instructions
└── images/           # Folder containing your OCT scan images
    ├── new_images/   # (Optional) All raw images can be placed here initially
    ├── unsorted/     # Will be created automatically by eye_sorter.py
    ├── left/         # Folder for left eye images (to be sorted manually)
    ├── right/        # Folder for right eye images (to be sorted manually)
    └── invalid/      # Folder for images that fail OCR or pre-check
```

---

 Installation Steps

1. Clone or Download the Repository:

   If you haven’t already, clone the repository:
   ```bash
   git clone https://github.com/yourusername/your-repo.git
   cd your-repo
   ```

2. Set Up Your Python Virtual Environment (Optional but Recommended):
   ```bash
   python -m venv venv
   source venv/bin/activate   # On Windows use: venv\Scripts\activate
   ```

3. Install Dependencies:
   If you have a `requirements.txt` file:
   ```bash
   pip install -r requirements.txt
   ```
   Otherwise, manually install the required packages:
   ```bash
   pip install opencv-python pytesseract pandas openpyxl
   ```

4. Configure Tesseract (if necessary):
   If Tesseract is not in your system’s PATH, update the script(s) to point to the Tesseract executable. For example, in Python:
   ```python
   pytesseract.pytesseract.tesseract_cmd = r'/path/to/tesseract'
   ```

---

 Usage

Step 1: Process the OCT Images
1. Copy your OCT images into the designated folder (e.g., `images/new_images/`).
2. Run `eye_sorter.py`:
   - This script will automatically create necessary subfolders (unsorted, left, right, invalid, processed).
   - It performs an initial pass on each image:
     - Moves images to the `unsorted` folder if they pass the pre-check.
     - Moves images that fail OCR (e.g., unreadable dates or CFT values) to the `invalid` folder.
   - Manual Step: Open the `unsorted` folder and manually move valid images into the `left` or `right` folders as appropriate.
   - Once sorted, press Enter in the terminal to proceed.
   - The script then generates two Excel files (`left_results_*.xlsx` and `right_results_*.xlsx`) in the main project folder.

Step 2: Generate the Final Tracking Sheet
1. Run `oct-tracker-final.py`:
   - The script will prompt you for:
     - The main folder path (where your Excel files exist).
     - Patient ID.
     - Which eye (left or right).
     - Number of treatments/injections.
     - Injection dates (in MM/DD/YY format).
     - Final checkup date (if applicable).
   - It then reads the latest Excel file for the chosen eye, extracts the OCT/CFT values near each injection date, and finds the best (lowest) value between treatment dates.
   - A final tracking sheet is generated as an Excel file (e.g., `[PatientID]_left_tracking_YYYYMMDDHHMMSS.xlsx`).

Step 3: Review Your Output
- Open the generated tracking sheet in Excel.
- Verify that the columns, dates, and CFT values are correct and clearly formatted.

---

 Contributing

If you’d like to contribute improvements or new features:
1. Fork the repository.
2. Create a new branch for your changes.
3. Submit a pull request with a clear description of your modifications.

---

 Troubleshooting

- Tesseract Issues:  
  Make sure that the Tesseract OCR engine is installed and its path is correctly set in your scripts.

- Missing Dependencies:  
  Double-check that all required Python libraries are installed (use `pip list` to verify).

- File Paths:  
  Verify that your project folder structure matches what the scripts expect. Adjust paths in the code if necessary.

